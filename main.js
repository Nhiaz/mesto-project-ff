(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function n(e,n,r){return(n=function(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}var r={baseUrl:"https://nomoreparties.co/v1/wff-cohort-18",headers:{authorization:"ad7c8cda-be8b-428f-80a7-1bafe19ad7d0","Content-Type":"application/json"}},o=function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))},c=function(t,c){return fetch("".concat(r.baseUrl).concat(t),function(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?e(Object(o),!0).forEach((function(e){n(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}({headers:r.headers},c)).then(o)};const u=function(){return c("/cards")},i=function(t,e){return c("/cards",{method:"POST",body:JSON.stringify({name:t,link:e})})},a=function(t){return c("/cards/".concat(t),{method:"DELETE"})},l=function(t){return c("/cards/likes/".concat(t),{method:"PUT"})},s=function(t){return c("/cards/likes/".concat(t),{method:"DELETE"})},p=function(){return c("/users/me")},d=function(t,e){return c("/users/me",{method:"PATCH",body:JSON.stringify({name:t,about:e})})},f=function(t){return c("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:t})})};function _(t,e,n,r,o,c){var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,i=arguments.length>7&&void 0!==arguments[7]&&arguments[7],a=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),l=a.querySelector(".card__delete-button"),s=a.querySelector(".card__like-button"),p=a.querySelector(".card__like-counter"),d=a.querySelector(".card__image"),f=a.querySelector(".card__title");return i&&s.classList.toggle("card__like-button_is-active"),f.textContent=t,p.textContent=u,d.src=e,d.alt="На фотографии изображён: ".concat(t),l.dataset.cardId=c,s.dataset.cardId=c,l.addEventListener("click",n),s.addEventListener("click",(function(t){return r(t,p)})),d.addEventListener("click",(function(){o(t,e)})),a}var y=function(t,e){a(t.target.dataset.cardId).then((function(){return t.target.closest(".places__item").remove()})).catch((function(t){return console.log(t)}))},m=function(t,e){var n=t.target.closest(".card__like-button");n.classList.contains("card__like-button_is-active")?s(n.dataset.cardId).then((function(){n.classList.toggle("card__like-button_is-active"),e.textContent=Number(e.textContent)-1})).catch((function(t){return console.log(t)})):l(n.dataset.cardId).then((function(){n.classList.toggle("card__like-button_is-active"),e.textContent=Number(e.textContent)+1})).catch((function(t){return console.log(t)}))};function v(t){t.classList.add("popup_is-opened"),t.addEventListener("click",S),document.addEventListener("keydown",g)}function b(t){t.classList.remove("popup_is-opened"),t.removeEventListener("click",S),document.removeEventListener("keydown",g)}function S(t){t.currentTarget===t.target&&b(t.target.closest(".popup"))}function g(t){"Escape"===t.key&&b(document.querySelector(".popup_is-opened"))}var h=".popup__input",q=".popup__button",L="popup__button_disabled",E="popup__input_type_error",k="popup__error_visible",C=function(t,e){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(E),n.classList.remove(k),n.textContent=""},O=function(t,e){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(L),e.removeAttribute("disabled",!1)):(e.classList.add(L),e.setAttribute("disabled",!0))},x=function(t){var e=Array.from(t.querySelectorAll(h)),n=t.querySelector(q);e.textContent="",O(e,n),e.forEach((function(e){C(t,e),e.setCustomValidity(""),e.classList.remove(E)}))};function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var w=document.querySelector(".popup_type_edit"),P=document.querySelector(".popup_type_new-card"),A=document.querySelector(".popup_type_avatar"),D=document.querySelector(".popup__input_image"),I=document.querySelector(".places__list"),T=document.querySelector(".popup__input_type_card-name"),N=document.querySelector(".popup__input_type_url"),U=document.querySelector(".popup__form[name=new-place]"),J=document.querySelector(".popup__form[name=edit-profile]"),H=(document.querySelector(".popup__form[name=edit-avatar]"),document.querySelector(".popup__input_type_name")),M=document.querySelector(".popup__input_type_description"),z=document.querySelector(".profile__title"),V=document.querySelector(".profile__description"),$=document.querySelector(".profile__image"),B=document.querySelector(".popup__image"),F=document.querySelector(".popup__caption");function G(t,e){v(A),F.textContent=t,B.src=e,B.alt=t}w.classList.add("popup_is-animated"),P.classList.add("popup_is-animated"),A.classList.add("popup_is-animated"),Promise.all([u(),p()]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,u,i=[],a=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=c.call(n)).done)&&(i.push(r.value),i.length!==e);a=!0);}catch(t){l=!0,o=t}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return j(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],c=r[1];z.textContent=c.name,V.textContent=c.about,$.style.backgroundImage="url(".concat(c.avatar,")"),o.forEach((function(t){var e=_(t.name,t.link,y,m,G,t._id,t.likes.length,!!t.likes.filter((function(t){return t._id===c._id})).length);I.append(e)}))})).catch((function(t){return console.log(t)})),A.addEventListener("submit",(function(t){t.preventDefault();var e=A.querySelector(".popup__button");e.textContent="Сохранение...",f(D.value).then((function(t){$.style.backgroundImage="url(".concat(t.avatar,")"),e.textContent="Сохранить"})).catch((function(t){return console.log(t)}))})),U.addEventListener("submit",(function(t){var e=U.querySelector(".popup__button");e.textContent="Сохранение...",i(T.value,N.value).then((function(n){var r=_(T.value,N.value,y,m,G,n._id);I.prepend(r),b(P),t.preventDefault(),t.target.reset(),e.textContent="Сохранить"})).catch((function(t){return console.log(t)}))})),J.addEventListener("submit",(function(t){t.preventDefault();var e=J.querySelector(".popup__button");e.textContent="Сохранение...",d(H.value,M.value).then((function(t){z.textContent=t.name,V.textContent=t.about,b(w),e.textContent="Сохранить"})).catch((function(t){return console.log(t)}))})),$.addEventListener("click",(function(){v(A),D.focus()})),document.querySelector(".profile__add-button").addEventListener("click",(function(){v(P),T.focus(),x(P)})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){v(w),H.focus(),H.value=z.textContent,M.value=V.textContent,x(w)})),A.querySelector(".popup__close").addEventListener("click",(function(){b(A)})),P.querySelector(".popup__close").addEventListener("click",(function(){b(P)})),w.querySelector(".popup__close").addEventListener("click",(function(){b(w)})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t){var e=Array.from(t.querySelectorAll(h)),n=t.querySelector(q);O(e,n),e.forEach((function(r){r.addEventListener("input",(function(){(function(t,e){e.validity.valid?C(t,e):function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(E),r.textContent=n,r.classList.add(k)}(t,e,e.validationMessage)})(t,r),O(e,n)}))}))}(t)}))})();